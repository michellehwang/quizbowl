<!DOCTYPE HTML>
<html lang="en">
	<head>
		<title>Quizbowl DB</title>
    <script type="text/javascript" src="http://www.flotype.com/js/bridge.min.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
		<meta http-equiv="Content-Language" content="en-us">
    <script>
      window.fbAsyncInit = function() {
        FB.init({
          appId      : '378548848840009', // App ID
          status     : true, // check login status
          cookie     : true, // enable cookies to allow the server to access the session
          xfbml      : true, // parse XFBML
          oauth      : true
        });
        console.log("SUP");
        var bridge = new Bridge({apiKey:"08c83c72"});
        bridge.connect();
        console.log(bridge);
        var handler = 
                {
                  onChat:function(user, message) {
                    console.log(user, message);
                  },
                  onNewWord:function(word) {
                    $('#text').append(word+" ");
                  },
                  onSystemBroadcast:function(message){
                    console.log("SYSTEM: "+message);
                  },
                  onBuzz:function(user, message){
                    console.log(user, "BUZZED IN");
                  },
                  onSit:function(user, team) {
                    console.log(user+" sat on "+team);
                  },
                  onStartQuestion:function(){
                    $("#text").html("");
                  },
                  onCompleteQuestion:function(question) {
                    $('#text').html(question.question+"<br />ANSWER: "+question.answer);
                  }
                };
        bridge.getService("quizbowl-auth",function(auth){
          auth.login(FB.getAccessToken(), function(blah){
            bridge.getService('quizbowl-multiplayer', function(obj) {
            console.log(blah);
            obj.getRooms(function(rooms){
              if (rooms.length > 0) {
                rooms[0].join(blah.id,
                  handler,
                  function(handler) {
                    window.handler = handler;
                  }
                );
              } else {
                obj.createRoom(blah.id,function(o) {
                  room = o;
                  o.join(blah.id,
                    handler,
                    function(handler) {
                      window.handler = handler;
                    }
                  );
                });
              }
            });
          });
          });
        });
      };

      // Load the SDK Asynchronously
      (function(d){
        var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}
        js = d.createElement('script'); js.id = id; js.async = true;
        js.src = "//connect.facebook.net/en_US/all.js";
        d.getElementsByTagName('head')[0].appendChild(js);
      }(document));
      $(document).ready(function(){
        $("#buzz").click(function(){
          console.log("BUZZED");
          window.handler.buzz();
        });
        $("#answer").keypress(function(event) {
          console.log(event);
          if ( event.which == 13 ) {
            window.handler.answer($("#answer").val(), function(right) {
              $("#response").val(right+"");
            });
          }
        });
      });
    </script>
    <div id="fb-root"></div>
    <script>
    </script>
  </head>
  <body>
    <a><li id="login" class="nav-ele"><div class="fb-login-button" data-scope="email">Login</div></li></a>
    <div id="container">
      <div id="menu">
      </div>
      <%-body%>
    </div>
  </body>

</html>
